PaddleClas支持通过修改配置文件(.yaml)的方式，灵活便捷的配置模型训练参数。导入PaddleClas，其中包括众多图像分类在各类数据集上的默认配置，进行调试和修改。查找网上资料，表现好的模型都是ResNet，因此在ResNet系类模型中进行选择和评估。

配置文档：https://paddleclas.readthedocs.io/zh-cn/latest/tutorials/config.html

实验环境：

| GPU 1080Ti+CUDA11.6 | Ubuntu | python3.8 | paddle 2.2.2 |
| ------------------- | ------ | --------- | ------------ |

## 一、数据处理

**图像变换**：

- 训练数据以图像中心点扩散随机裁剪成目标尺寸224 \* 224大小，测试数据Resize为224 \* 224。

- 将所有数据转换成RGB模式。

**图像增强**：

- 计算训练集上所有图片的均值[0.4848, 0.4435, 0.4023]和方差[0.2744, 0.2688, 0.2757]，用此计算均值和方差对所有数据进行归一化。

  训练集上——均值[0.4848, 0.4435, 0.4023]方差[0.2744, 0.2688, 0.2757]

  ImageNet——均值[0.485, 0.456, 0.406]方差[0.229, 0.224, 0.225]

  **测试**——训练集 Vs ImageNet

- 训练数据以随机概率沿Y轴垂直翻转。

配置文件如下：

<img src="https://qinglan-1324038201.cos.ap-nanjing.myqcloud.com/images/202406052259683.png" alt="image-20240604221907135" style="zoom: 50%;" /><img src="https://qinglan-1324038201.cos.ap-nanjing.myqcloud.com/images/202406052259684.png" alt="image-20240604222458610" style="zoom:50%;" />

## 二、配置模型

- 参数设置阶段

  - 设置GPU

  - 设置优化器、学习策略：

    在整个训练过程中，不能使用同样的学习率来更新权重，否则无法到达最优点，所以需要在训练过程中调整学习率的大小。初始损失函数相对容易进行梯度下降，所以可以设置一个较大的学习率。在训练后期，由于权重参数已经接近最优值，较大的学习率无法进一步寻找最优值，所以需要设置一个较小的学习率。

    **测试**——学习策略Cosine_decay和piecewise_decay

  - 设置损失函数：交叉熵CEloss

  - 加载预训练模型

- 训练过程

  - 迭代DataLoader
  - 优化器梯度清零
  - 模型推理
  - 误差计算
  - 反向传播
  - 更新优化器、学习率

预测结果部分如下：

![image-20240605225351566](https://qinglan-1324038201.cos.ap-nanjing.myqcloud.com/images/202406052259685.png)
